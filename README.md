# Практическое занятие №7

Ходыч Даниил Евгеньевич

ЭФМО-02-25

# Запуск

Клонировать репозиторий -> запустить main.go

```bash
git clone https://github.com/danthemo/pz7-redis.git
cd pz7-redis
go run ./...
```

Запустить Redis через Docker:

```bash
docker run --name redis -p 6379:6379 redis
```

# Что такое Redis?

Redis (Remote Dictionary Server) - это высокопроизводительная in-memory система хранения данных, которая работает по принципу «ключ-значение». Все данные хранятся в оперативной памяти, что обеспечивает скорость доступа в миллисекунды. Redis поддерживает встроенный механизм TTL (time-to-live) - время жизни ключей, после которого ключ автоматически удаляется.

# Скриншоты работы

1. Сохранение значения в кэш:

```bash
curl "http://localhost:8080/set?key=test&value=hello"
```

!СКРИНШОТ

2. Получение значения из кэша:

```bash
curl "http://localhost:8080/get?key=test"
```

!СКРИНШОТ

3. Проверка TTL ключа:

```bash
curl "http://localhost:8080/ttl?key=test"
```

!СКРИНШОТ

# Ответы на контрольные вопросы

### 1. Чем Redis отличается от реляционной БД?

Redis - это in-memory key-value хранилище, которое работает в оперативной памяти и обеспечивает экстремально быстрый доступ к данным. Реляционная БД работает на диске, что медленнее, но обеспечивает постоянное хранение и поддерживает сложные связи между таблицами через SQL-запросы.

Ключевые различия:

- **Тип хранения**: Redis в памяти, БД на диске
- **Скорость**: Redis быстрее в разы для операций чтения
- **Типы данных**: Redis поддерживает простые структуры (строки, списки, хэши), БД - полноценные таблицы
- **Назначение**: Redis для кэширования и сессий, БД для постоянного хранения данных
- **Персистентность**: Redis нуждается в RDB/AOF для сохранения на диск, БД сохраняет данные автоматически

### 2. Какие типы данных поддерживает Redis кроме строк?

Redis поддерживает следующие основные структуры данных:

- **Strings** - простые строковые значения
- **Lists** - упорядоченные списки элементов
- **Sets** - неупорядоченные множества уникальных элементов
- **Sorted Sets** - упорядоченные множества с весом/рейтингом
- **Hashes** - структуры данных с именованными полями (как словари)
- **Bitmaps** - битовые массивы для флагов и счётчиков
- **HyperLogLog** - вероятностная структура для подсчёта уникальных элементов
- **Geospatial** - географические данные для поиска по расстоянию
- **Streams** - потоки событий

### 3. Зачем нужен TTL? Приведите примеры.

TTL (Time-To-Live) - это время жизни ключа в Redis. После истечения TTL ключ автоматически удаляется. TTL необходим для:

- **Кэширование результатов**: Сохранять результат запроса к БД на 5 минут, потом обновить. Пример: список популярных товаров обновляется каждые 5 минут.
- **Сессии пользователей**: Хранить токен сессии 1 час, затем заставить переавторизоваться.
- **Одноразовые коды**: SMS-коды подтверждения живут 10 минут, потом становятся невалидными.
- **Ограничение частоты запросов**: Rate limiting — разрешить 100 запросов за минуту, TTL очищает счётчик.
- **Временные кэши**: Кэш результатов поиска на 30 секунд для популярных запросов.
- **Предотвращение переполнения памяти**: TTL гарантирует, что старые данные не займут всю память.

Пример:

```bash
SETEX session:user123 3600 "token_abc"  # Сессия живёт 1 час
TTL session:user123  # 3600 (можно проверить оставшееся время)
```

### 4. Как Redis помогает снизить нагрузку на PostgreSQL?

Redis кэширует часто запрашиваемые данные, чтобы уменьшить число обращений к БД:

**Без Redis:**

- Клиент запрашивает список товаров -> Backend делает SELECT из PostgreSQL -> Возвращает результат
- 1000 одновременных запросов -> 1000 обращений к БД -> высокая нагрузка

**С Redis:**

- Клиент запрашивает список товаров -> Backend проверяет Redis
- Если есть кэш -> возвращает из Redis
- Если нет -> берёт из PostgreSQL -> сохраняет в Redis на TTL -> возвращает
- 1000 одновременных запросов -> 1 обращение к БД, остальные 999 из Redis -> нагрузка минимальна

**Выигрыш:**

- Уменьшение нагрузки на CPU/диск PostgreSQL
- Снижение потребления памяти в БД
- Ускорение ответа API в разы
- Возможность обслужить больше пользователей с тем же оборудованием

### 5. Что произойдёт, если ключ в Redis «протух» по TTL, а приложение попытается его прочитать?

Если ключ истёк по TTL и приложение попытается его получить:

1. Redis вернёт ошибку ключ не найден
2. Приложение получит ошибку вида `redis: nil`
3. Обработав ошибку, приложение должно:
   - Загрузить данные из PostgreSQL
   - Сохранить их в Redis с новым TTL
   - Вернуть данные клиенту
